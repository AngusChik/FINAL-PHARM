{% extends "base.html" %}
{% block title %}Add New Product{% endblock %}
{% block content %}

<style>
  /* Scoped styles so it won't mess other pages */
  .newprod-page{
    padding: 20px;
    max-width: 1100px;
    margin: 0 auto;
  }

  .newprod-header{
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color:#fff;
    padding: 26px 26px;
    border-radius: 18px;
    box-shadow: 0 10px 28px rgba(0,0,0,.14);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 14px;
    flex-wrap: wrap;
    margin-bottom: 18px;
  }

  .newprod-title{
    margin:0;
    font-size: 34px;
    font-weight: 900;
    letter-spacing: -0.6px;
  }

  .newprod-sub{
    margin-top: 6px;
    font-size: 13px;
    opacity: .92;
  }

  .newprod-actions{
    display:flex;
    gap: 10px;
    align-items:center;
    flex-wrap: wrap;
  }

  .np-btn{
    border: none;
    border-radius: 12px;
    padding: 10px 14px;
    font-weight: 900;
    cursor: pointer;
    letter-spacing: .3px;
    transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
    white-space: nowrap;
  }
  .np-btn:active{ transform: translateY(1px); }

  .np-btn.soft{
    background:#f6f8ff;
    color:#4b55c1;
    border:2px solid rgba(102,126,234,.25);
    box-shadow: 0 6px 18px rgba(102,126,234,.12);
  }
  .np-btn.soft:hover{ box-shadow: 0 10px 22px rgba(102,126,234,.18); transform: translateY(-1px); }

  .np-btn.primary{
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color:#fff;
    box-shadow: 0 10px 22px rgba(40,167,69,.22);
  }
  .np-btn.primary:hover{ filter: brightness(.98); box-shadow: 0 12px 26px rgba(40,167,69,.30); transform: translateY(-1px); }

  .np-card{
    background:#fff;
    border-radius: 18px;
    box-shadow: 0 8px 26px rgba(0,0,0,.08);
    border: 2px solid #f0f0f0;
    overflow: hidden;
  }

  .np-card-head{
    padding: 18px 20px;
    border-bottom: 2px solid #f4f4f7;
    background: linear-gradient(135deg, #ffffff 0%, #f7f8ff 100%);
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .np-card-head h3{
    margin:0;
    font-size: 13px;
    font-weight: 900;
    color:#333;
    text-transform: uppercase;
    letter-spacing: .6px;
  }

  .np-card-body{
    padding: 18px 20px 20px;
  }

  .np-errors{
    border: 2px solid rgba(220,53,69,.25);
    background: rgba(220,53,69,.06);
    padding: 12px 12px;
    border-radius: 14px;
    margin-bottom: 14px;
    color: #8a1f28;
    font-weight: 800;
    font-size: 13px;
  }

  .np-grid{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 14px;
  }
  @media (max-width: 820px){
    .np-grid{ grid-template-columns: 1fr; }
  }

  .np-field{ display:flex; flex-direction:column; gap: 7px; }
  .np-field label{
    font-size: 11px;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: .5px;
    color:#555;
  }

  /* Style without needing widget-tweaks: target actual inputs inside page */
  .newprod-page input[type="text"],
  .newprod-page input[type="number"],
  .newprod-page input[type="date"],
  .newprod-page select,
  .newprod-page textarea{
    width: 100%;
    padding: 12px 14px;
    border: 2px solid #e8e8e8;
    border-radius: 12px;
    background: #fafafa;
    font-size: 15px;
    transition: border-color 160ms ease, box-shadow 160ms ease, background 160ms ease;
    margin: 0;
  }
  .newprod-page textarea{ min-height: 95px; resize: vertical; }

  .newprod-page input:focus,
  .newprod-page select:focus,
  .newprod-page textarea:focus{
    outline: none;
    border-color:#667eea;
    background:#fff;
    box-shadow: 0 0 0 4px rgba(102,126,234,.12);
  }

  .np-help{
    font-size: 12px;
    color:#888;
    margin-top: -4px;
  }

  .np-field-errors{
    margin-top: 2px;
    font-size: 12px;
    font-weight: 800;
    color:#c00;
  }

  .np-wide{ grid-column: 1 / -1; }

  .np-checkline{
    display:flex;
    align-items:center;
    gap: 10px;
    padding: 12px 14px;
    border: 2px solid #e8e8e8;
    border-radius: 12px;
    background:#fafafa;
  }
  .np-checkline input[type="checkbox"]{
    width: 18px;
    height: 18px;
    accent-color: #667eea;
  }
  .np-footer{
    display:flex;
    justify-content:flex-end;
    gap: 10px;
    margin-top: 16px;
    padding-top: 14px;
    border-top: 2px solid #f4f4f7;
  }
</style>

<div class="newprod-page">
  <div class="newprod-header">
    <div>
      <h1 class="newprod-title">＋ Add New Product</h1>
      <div class="newprod-sub">Create a new item in inventory. Fields will stay filled if validation fails.</div>
    </div>

    <div class="newprod-actions">
      <button type="button" class="np-btn soft" id="autofillButton">Auto-Fill Sample</button>
      <a class="np-btn soft" href="{{ next|default:'/checkin/' }}">← Back</a>
    </div>
  </div>

  <div class="np-card">
    <div class="np-card-head">
      <h3>Product information</h3>
    </div>

    <div class="np-card-body">
      {% if form.non_field_errors %}
        <div class="np-errors">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <form method="post" id="productForm" novalidate>
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ next }}">

        <div class="np-grid">
          <div class="np-field">
            <label for="{{ form.name.id_for_label }}">Name</label>
            {{ form.name }}
            {% if form.name.errors %}<div class="np-field-errors">{{ form.name.errors }}</div>{% endif %}
          </div>
<!--
          <div class="np-field">
            <label for="{{ form.brand.id_for_label }}">Brand</label>
            {{ form.brand }}
            {% if form.brand.errors %}<div class="np-field-errors">{{ form.brand.errors }}</div>{% endif %}
          </div>
        -->
          <div class="np-field">
            <label for="{{ form.category.id_for_label }}">Category</label>
            {{ form.category }}
            {% if form.category.errors %}<div class="np-field-errors">{{ form.category.errors }}</div>{% endif %}
          </div>

          <div class="np-field">
            <label for="{{ form.item_number.id_for_label }}">Item Number</label>
            {{ form.item_number }}
            {% if form.item_number.errors %}<div class="np-field-errors">{{ form.item_number.errors }}</div>{% endif %}
          </div>

          <div class="np-field">
            <label for="{{ form.barcode.id_for_label }}">Barcode</label>
            {{ form.barcode }}
            <div class="np-help">Leave blank only if your model allows blank/NULL unique barcodes.</div>
            {% if form.barcode.errors %}<div class="np-field-errors">{{ form.barcode.errors }}</div>{% endif %}
          </div>

          <div class="np-field">
            <label for="{{ form.unit_size.id_for_label }}">Unit Size</label>
            {{ form.unit_size }}
            {% if form.unit_size.errors %}<div class="np-field-errors">{{ form.unit_size.errors }}</div>{% endif %}
          </div>

          <div class="np-field np-wide">
            <label for="{{ form.description.id_for_label }}">Description</label>
            {{ form.description }}
            {% if form.description.errors %}<div class="np-field-errors">{{ form.description.errors }}</div>{% endif %}
          </div>

          <div class="np-field">
            <label for="{{ form.price_per_unit.id_for_label }}">Cost Per Unit</label>
            {{ form.price_per_unit }}
            {% if form.price_per_unit.errors %}<div class="np-field-errors">{{ form.price_per_unit.errors }}</div>{% endif %}
          </div>

          <div class="np-field">
            <label for="{{ form.price.id_for_label }}">Price</label>
            {{ form.price }}
            {% if form.price.errors %}<div class="np-field-errors">{{ form.price.errors }}</div>{% endif %}
          </div>

          <div class="np-field">
            <label for="{{ form.quantity_in_stock.id_for_label }}">Quantity</label>
            {{ form.quantity_in_stock }}
            {% if form.quantity_in_stock.errors %}<div class="np-field-errors">{{ form.quantity_in_stock.errors }}</div>{% endif %}
          </div>

          <div class="np-field">
            <label for="{{ form.expiry_date.id_for_label }}">Expiry Date</label>
            {{ form.expiry_date }}
            {% if form.expiry_date.errors %}<div class="np-field-errors">{{ form.expiry_date.errors }}</div>{% endif %}
          </div>

          <div class="np-field np-wide">
            <label>Tax</label>
            <div class="np-checkline">
              {{ form.taxable }}
              <span style="font-weight:900;color:#333;">Taxable</span>
            </div>
            {% if form.taxable.errors %}<div class="np-field-errors">{{ form.taxable.errors }}</div>{% endif %}
          </div>
        </div>

        <div class="np-footer">
          <button type="submit" class="np-btn primary">Add Product</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Auto-fill with VALID values (no strings in number inputs)
  document.getElementById('autofillButton').addEventListener('click', function () {
    const setVal = (selector, value) => {
      const el = document.querySelector(selector);
      if (!el) return;
      el.value = value;
      el.dispatchEvent(new Event('input', { bubbles: true }));
      el.dispatchEvent(new Event('change', { bubbles: true }));
    };

    // These selectors match Django's default generated ids: id_<fieldname>
    setVal('#id_name', 'Temp Product Name');
    setVal('#id_brand', 'Temp Brand');
    setVal('#id_item_number', 'TMP-' + Math.floor(10000 + Math.random() * 90000));
    setVal('#id_barcode', '');                 // leave blank if allowed; otherwise put a real barcode
    setVal('#id_unit_size', '120 caplets');
    setVal('#id_description', 'Temporary description — update with real details.');
    setVal('#id_price_per_unit', '8.50');
    setVal('#id_price', '18.99');
    setVal('#id_quantity_in_stock', '10');

    // expiry: 6 months from today (rough)
    const d = new Date();
    d.setMonth(d.getMonth() + 6);
    setVal('#id_expiry_date', d.toISOString().slice(0, 10));

    // taxable checkbox
    const tax = document.querySelector('#id_taxable');
    if (tax) tax.checked = true;
  });
</script>

{% endblock %}
